const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./pass.fragment-c8NWqyqH.js","./index-CtkNjb3d.js","./pass.fragment-D-Joehqf.js","./passCube.fragment-Bwn4RcKZ.js","./passCube.fragment-CToHhL6Q.js"])))=>i.map(i=>d[i]);
import{i as W,j as Y,a as G,C as P,k as L,V as t,h as k,f as R,l as D,m as B,n as Z,s as j,A as q,P as U,o as X}from"./index-CtkNjb3d.js";class A{constructor(e,a,r,s){this.name=e,this.worldAxisForNormal=a,this.worldAxisForFileX=r,this.worldAxisForFileY=s}}class O{static ConvertCubeMapTextureToSphericalPolynomial(e){var g;if(!e.isCube)return null;(g=e.getScene())==null||g.getEngine().flushFramebuffer();const a=e.getSize().width,r=e.readPixels(0,void 0,void 0,!1),s=e.readPixels(1,void 0,void 0,!1);let i,n;e.isRenderTarget?(i=e.readPixels(3,void 0,void 0,!1),n=e.readPixels(2,void 0,void 0,!1)):(i=e.readPixels(2,void 0,void 0,!1),n=e.readPixels(3,void 0,void 0,!1));const d=e.readPixels(4,void 0,void 0,!1),w=e.readPixels(5,void 0,void 0,!1),f=e.gammaSpace,N=5;let C=0;return(e.textureType==1||e.textureType==2)&&(C=1),new Promise(E=>{Promise.all([s,r,i,n,d,w]).then(([F,m,u,h,p,_])=>{const I={size:a,right:m,left:F,up:u,down:h,front:p,back:_,format:N,type:C,gammaSpace:f};E(this.ConvertCubeMapToSphericalPolynomial(I))})})}static _AreaElement(e,a){return Math.atan2(e*a,Math.sqrt(e*e+a*a+1))}static ConvertCubeMapToSphericalPolynomial(e){const a=new W;let r=0;const s=2/e.size,i=s,n=.5*s,d=n-1;for(let g=0;g<6;g++){const E=this._FileFaces[g],F=e[E.name];let m=d;const u=e.format===5?4:3;for(let h=0;h<e.size;h++){let p=d;for(let _=0;_<e.size;_++){const I=E.worldAxisForFileX.scale(p).add(E.worldAxisForFileY.scale(m)).add(E.worldAxisForNormal);I.normalize();const z=this._AreaElement(p-n,m-n)-this._AreaElement(p-n,m+n)-this._AreaElement(p+n,m-n)+this._AreaElement(p+n,m+n);let l=F[h*e.size*u+_*u+0],o=F[h*e.size*u+_*u+1],c=F[h*e.size*u+_*u+2];isNaN(l)&&(l=0),isNaN(o)&&(o=0),isNaN(c)&&(c=0),e.type===0&&(l/=255,o/=255,c/=255),e.gammaSpace&&(l=Math.pow(P(l),L),o=Math.pow(P(o),L),c=Math.pow(P(c),L));const T=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const v=Math.max(l,o,c);if(v>T){const y=T/v;l*=y,o*=y,c*=y}}else l=P(l,0,T),o=P(o,0,T),c=P(c,0,T);const H=new Y(l,o,c);a.addLight(I,H,z),r+=z,p+=s}m+=i}}const C=4*Math.PI*6/6/r;return a.scaleInPlace(C),a.convertIncidentRadianceToIrradiance(),a.convertIrradianceToLambertianRadiance(),G.FromHarmonics(a)}}O._FileFaces=[new A("right",new t(1,0,0),new t(0,0,-1),new t(0,-1,0)),new A("left",new t(-1,0,0),new t(0,0,1),new t(0,-1,0)),new A("up",new t(0,1,0),new t(1,0,0),new t(0,0,1)),new A("down",new t(0,-1,0),new t(1,0,0),new t(0,0,-1)),new A("front",new t(0,0,1),new t(1,0,0),new t(0,-1,0)),new A("back",new t(0,0,-1),new t(-1,0,0),new t(0,-1,0))];O.MAX_HDRI_VALUE=4096;O.PRESERVE_CLAMPED_COLORS=!1;class S extends k{_gatherImports(e,a){e?(this._webGPUReady=!0,a.push(Promise.all([R(()=>import("./pass.fragment-c8NWqyqH.js"),__vite__mapDeps([0,1]),import.meta.url)]))):a.push(Promise.all([R(()=>import("./pass.fragment-D-Joehqf.js"),__vite__mapDeps([2,1]),import.meta.url)])),super._gatherImports(e,a)}constructor(e,a=null,r){super({...r,name:e,engine:a||D.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:S.FragmentUrl})}}S.FragmentUrl="pass";class M extends k{_gatherImports(e,a){e?(this._webGPUReady=!0,a.push(Promise.all([R(()=>import("./passCube.fragment-Bwn4RcKZ.js"),__vite__mapDeps([3,1]),import.meta.url)]))):a.push(Promise.all([R(()=>import("./passCube.fragment-CToHhL6Q.js"),__vite__mapDeps([4,1]),import.meta.url)])),super._gatherImports(e,a)}constructor(e,a=null,r){super({...r,name:e,engine:a||D.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:M.FragmentUrl,defines:"#define POSITIVEX"}),this._face=0}get face(){return this._face}set face(e){if(!(e<0||e>5))switch(this._face=e,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ");break}}}M.FragmentUrl="passCube";class V extends U{getClassName(){return"PassPostProcess"}constructor(e,a,r=null,s,i,n,d=0,w=!1){const f={size:typeof a=="number"?a:void 0,camera:r,samplingMode:s,engine:i,reusable:n,textureType:d,blockCompilation:w,...a};super(e,S.FragmentUrl,{effectWrapper:typeof a=="number"||!a.effectWrapper?new S(e,i,f):void 0,...f})}static _Parse(e,a,r,s){return X.Parse(()=>new V(e.name,e.options,a,e.renderTargetSamplingMode,e._engine,e.reusable),e,r,s)}}B("BABYLON.PassPostProcess",V);class x extends U{get face(){return this._effectWrapper.face}set face(e){this._effectWrapper.face=e}getClassName(){return"PassCubePostProcess"}constructor(e,a,r=null,s,i,n,d=0,w=!1){const f={size:typeof a=="number"?a:void 0,camera:r,samplingMode:s,engine:i,reusable:n,textureType:d,blockCompilation:w,...a};super(e,S.FragmentUrl,{effectWrapper:typeof a=="number"||!a.effectWrapper?new M(e,i,f):void 0,...f})}static _Parse(e,a,r,s){return X.Parse(()=>new x(e.name,e.options,a,e.renderTargetSamplingMode,e._engine,e.reusable),e,r,s)}}Z([j()],x.prototype,"face",null);q._RescalePostProcessFactory=b=>new V("rescale",1,null,2,b,!1,0);export{O as C};
